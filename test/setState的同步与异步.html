<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>
  <div id="example"></div>
  <script type="text/javascript" src="./js/react.development.js"></script>
  <script type="text/javascript" src="./js/react-dom.development.js"></script>
  <script type="text/javascript" src="./js/babel.min.js"></script>
  <script src="https://cdn.bootcss.com/remarkable/1.7.1/remarkable.min.js"></script>

  <script type="text/babel">
    class A extends React.Component {
      state = {
        count:0
      }
      
      /*
      在react的事件监听回调函数中，setState()是异步更新状态
      */
      update1 = ()=>{
        console.log('update1 setState()之前',this.state.count)
        this.setState(state=>({count:state.count+1}))
        console.log('update1 setState()之后',this.state.count)
      }

      /*
      定时器回调
      */
      update2 = ()=>{
        setTimeout(() => {
          console.log('setTimeout() setState()之前',this.state.count)
          this.setState(state=>({count:state.count+1}))
          console.log('setTimeout() setState()之后',this.state.count)
        });
      }

      /*
      原生事件监听回调
      */
      update3 = ()=>{
        const h2 = this.refs.count
        h2.onclick = ()=>{
          console.log('onclick() setState()之前',this.state.count)
          this.setState(state=>({count:state.count+1}))
          console.log('onclick() setState()之后',this.state.count)
        }
      }

      /*
      promise回调
      */
      update4 = ()=>{
        Promise.resolve().then(value=>{
          console.log('Promise setState()之前',this.state.count)
          this.setState(state=>({count:state.count+1}))
          console.log('Promise setState()之后',this.state.count)
        })
      }
      
      // setState(state=>({}))里面传函数改变状态
      update5 = () =>{
        console.log('setState(传函数)之前',this.state.count)
        this.setState(state=>({count:state.count+1}))
        console.log('setState(传函数)之后',this.state.count)
        console.log('setState(传函数)之前2',this.state.count)
        this.setState(state=>({count:state.count+1}))
        console.log('setState(传函数)之后2',this.state.count)
      }

      // setState({})里面传对象改变状态
      update6 = () =>{
        console.log('setState(传对象)之前',this.state.count)
        this.setState({count:this.state.count+1})
        console.log('setState(传对象)之后',this.state.count)
        console.log('setState(传对象)之前2',this.state.count)
        this.setState({count:this.state.count+1})
        console.log('setState(传对象)之后2',this.state.count)
      }


      /*
      在第一次render完成的之后,调用的生命周期钩子
      */
      componentDidMount(){
        console.log('componentDidMount() setState()之前',this.state.count)
        this.setState(state=>({count:state.count+1}))
        console.log('componentDidMount() setState()之后',this.state.count)
      }

      render(){
        const {count} = this.state
        console.log('render()',count)
        return (
          <div>
            <h2 ref='count'>{count}</h2>
            <button onClick={this.update1}>更新1</button>---
            <button onClick={this.update2}>更新2</button>&nbsp;&nbsp;
            <button onClick={this.update3}>更新3</button>&nbsp;&nbsp;
            <button onClick={this.update4}>更新4</button>---
            <button onClick={this.update5}>更新5</button>&nbsp;&nbsp;
            <button onClick={this.update6}>更新6</button>&nbsp;&nbsp;
          </div>
        )
      }
    }

    ReactDOM.render(<A />,document.getElementById('example'))
  </script>
</body>

</html>